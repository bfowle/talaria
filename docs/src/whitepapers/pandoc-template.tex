% Custom LaTeX template for academic papers
\documentclass[$if(fontsize)$$fontsize$$else$11pt$endif$,$if(papersize)$$papersize$$else$letterpaper$endif$,$if(sides)$$sides$$else$oneside$endif$]{article}

% Packages
\usepackage[margin=$if(margin)$$margin$$else$1in$endif$]{geometry}
\usepackage{amsmath,amssymb,amsfonts}
\usepackage{graphicx}
\usepackage{booktabs}
\usepackage{longtable}
\usepackage{array}
\usepackage{multirow}
\usepackage[table]{xcolor}
\usepackage{wrapfig}
\usepackage{float}
\usepackage{colortbl}
\usepackage{pdflscape}
\usepackage{tabu}
\usepackage{threeparttable}
\usepackage{threeparttablex}
\usepackage[normalem]{ulem}
\usepackage{makecell}
\usepackage{fancyhdr}
\usepackage{setspace}
\usepackage{parskip}
\usepackage{titlesec}
\usepackage{enumitem}

% Font settings
\usepackage{fontspec}
\setmainfont{Latin Modern Roman}
\setsansfont{Latin Modern Sans}
\setmonofont{Latin Modern Mono}

% Better typography
\usepackage{microtype}

% Hyperlinks
\usepackage{hyperref}
\hypersetup{
    colorlinks=true,
    linkcolor=blue!70!black,
    citecolor=blue!70!black,
    urlcolor=blue!70!black,
    pdftitle={$title$},
    pdfauthor={$author$},
}

% Section formatting
\titleformat{\section}
  {\normalfont\Large\bfseries}{\thesection}{1em}{}
\titleformat{\subsection}
  {\normalfont\large\bfseries}{\thesubsection}{1em}{}
\titleformat{\subsubsection}
  {\normalfont\normalsize\bfseries}{\thesubsubsection}{1em}{}

% Spacing
\titlespacing*{\section}{0pt}{3.5ex plus 1ex minus .2ex}{2.3ex plus .2ex}
\titlespacing*{\subsection}{0pt}{3.25ex plus 1ex minus .2ex}{1.5ex plus .2ex}
\titlespacing*{\subsubsection}{0pt}{3.25ex plus 1ex minus .2ex}{1.5ex plus .2ex}

% Paragraph settings
\setlength{\parindent}{0pt}
\setlength{\parskip}{0.8em}

% Line spacing
\onehalfspacing

% List settings
\setlist[itemize]{itemsep=0.3em, topsep=0.5em}
\setlist[enumerate]{itemsep=0.3em, topsep=0.5em}

% Code blocks
\usepackage{listings}
\lstset{
    basicstyle=\ttfamily\small,
    breaklines=true,
    frame=single,
    frameround=tttt,
    backgroundcolor=\color{gray!10},
    keywordstyle=\color{blue!70!black},
    commentstyle=\color{green!50!black},
    stringstyle=\color{red!70!black},
    showstringspaces=false,
    numbers=left,
    numberstyle=\tiny\color{gray},
    stepnumber=1,
    numbersep=10pt,
    captionpos=b,
    escapeinside={(*@}{@*)},
    belowskip=1em,
    aboveskip=1em,
}

% Tables
\renewcommand{\arraystretch}{1.3}
\arrayrulecolor{black!30}

% Headers and footers
\pagestyle{fancy}
\fancyhf{}
\rhead{\thepage}
\lhead{\leftmark}
\renewcommand{\headrulewidth}{0.4pt}
\renewcommand{\footrulewidth}{0pt}

% Title page settings
$if(title)$
\title{\vspace{-2cm}\huge\bfseries $title$}
$endif$
$if(author)$
\author{$for(author)$$author$$sep$ \and $endfor$}
$endif$
$if(date)$
\date{$date$}
$else$
\date{\today}
$endif$

% Abstract environment
\renewenvironment{abstract}{%
    \small
    \begin{center}
    \bfseries \abstractname\vspace{-.5em}\vspace{0pt}
    \end{center}
    \list{}{%
        \setlength{\leftmargin}{1.5cm}
        \setlength{\rightmargin}{1.5cm}
    }
    \item\relax
}{\endlist\vspace{1em}}

% Document
\begin{document}

$if(title)$
\maketitle
\thispagestyle{empty}
\vspace{1em}
$endif$

$body$

\end{document}